#textdomain wesnoth-Hero_of_Irdya_I

[scenario]
    id="02_Towards_the_North"
    name= _ "Towards the North"

# This is a very long scenario
# with changing objectives

    victory_when_enemies_defeated=no

    {SCENARIO_MAP_DATA 1 02A_Towards_the_North}
    {NEXT_SCENARIO 03_Into_the_Gloom}
    {TURNS 60 54 48}
    {TIME_OVER_DEFEAT}

    {STORY_TEXT_SCENARIO_02}

    {DEFAULT_SCHEDULE_24H}
    current_time=12

    [side]
        side=1
        {CHARACTER_STATS_JAHIN}
        canrecruit=yes
        controller=human
        fog=yes
        shroud=yes
        {FLAG_VARIANT ragged}
        team_name="good"
        user_team_name= _ "Adventurers"
        recruit=
        {NO_ECONOMY}
    [/side]

    {STARTING_VILLAGES 1 3}

    [side]
        side=2
        id="Alynoic"
        name= _ "female^Alynoic"
        gender=female
        type="Great Mage"
        canrecruit=yes
        fog=yes
        shroud=yes
        controller=ai
        {FLAG_VARIANT long}
        team_name="good"
        hidden=yes
        user_team_name= _ "The Academy"
        recruit="Brazier Imp, Furnace Beast, Fire Wisp, Kobold, Stone Golem, Razorbird, Thunderbird, Wisp, Ethereal Orb, Sylph, Zephyr, Ice Crab, Tidal, Undine, Mage, White Mage, Red Mage"
        {NO_ECONOMY}

        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT grouping defensive}
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.20}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0.80}            
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_diversity 0.8}
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_randomness 0}
            {AI_ASPECT recruitment_save_gold {AI_DEACTIVATE_SAVE_GOLD} }
        [/ai]
    [/side]

    {STARTING_VILLAGES 2 12}

    [side]
        side=3
        id="Wendell"
        name= _ "Lord Wendell"
        type="Sire"
        canrecruit=yes
        controller=ai
        fog=yes
        shroud=yes
        {FLAG_VARIANT loyalist}
        hidden=yes
        team_name="vampires"
        user_team_name= _ "Vampires"
#ifdef HARD
        recruit="Fledgeling, Thin Blood, Blood Apprentice, Gargoyle, Bloodborn, Blood Hulk, Blood Manipulator, Flesh Artisan, Vampire Duelist, Vampire Noble, Half Blood, Marlgoyle, True Vampire Bat, Vampiric Blood Bat"
#else
        recruit="Fledgeling, Thin Blood, Blood Apprentice, Gargoyle, Bloodborn, Blood Hulk, Vampire Duelist, Half Blood, Marlgoyle, True Vampire Bat, Vampiric Blood Bat"
#endif
        {NO_ECONOMY}

        [ai]
            [goal]
                name="target"
                [criteria]
                    side=1
                [/criteria]
                value=0.10
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=2
                [/criteria]
                value=0.60
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=6
                [/criteria]
                value=0.30
            [/goal]
        [/ai]

    [/side]

    {FORCE_CHANCE_TO_HIT (side=1,2,5,6,7,8,9,10,11,12,13) (id="Wendell") 0 ()}

    [side]
        side=4
        id="Kern"
        name= _ "Lt. Kern"
        type="Vampire Noble"
        gender=male
        canrecruit=yes
        controller=ai
        fog=yes
        shroud=yes
        {FLAG_VARIANT loyalist}
        hidden=yes
        team_name="vampires"
        user_team_name= _ "Vampires"
        recruit="Fledgeling, Thin Blood, Blood Apprentice, True Vampire Bat, Blood Hulk"
        {GOLD 220 250 300}
        {INCOME 6 7 8}
        [ai]
            {EXPERIMENTAL_AI}
        [/ai]
    [/side]

    {STARTING_VILLAGES 4 6}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Blood Hulk" 2}

    [side]
        side=5
        id="Gridash"
        name- _ "Gridash"
        type="Orcish Raider"
        canrecruit=yes
        controller=ai
        fog=yes
        shroud=yes
        {FLAG_VARIANT ragged}
        hidden=yes
        team_name="orcs"
        user_team_name= _ "Orcs"

#ifdef HARD
        recruit="Orcish Grunt, Orcish Warrior, Orcish Archer, Orcish Assassin, Orcish Shaman, Wolf Rider, Goblin Knight"
#else
        recruit="Orcish Grunt, Orcish Archer, Orcish Assassin, Orcish Shaman, Wolf Rider"
#endif

        {GOLD 220 250 300}
        {INCOME 6 7 8}
        [ai]
            {EXPERIMENTAL_AI}
        [/ai]
    [/side]

    {STARTING_VILLAGES 5 6}

#ifdef HARD
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Orcish Warrior" 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Goblin Knight" 3}
#endif

    [side]
        side=6
        id="Gushnak"
        name= _ "Gushnak"
        type="Orcish Warlord"
        canrecruit=yes
        controller=ai
        fog=yes
        shroud=yes
        {FLAG_VARIANT ragged}
        hidden=yes
        team_name="orcs"
        user_team_name= _ "Orcs"
#ifdef HARD
        recruit="Orcish Warrior, Orcish Grunt, Orcish Archer, Orcish Crossbowman, Orcish Pyro Archer, Orcish Shaman, Orcish Warlock, Wolf Rider, Goblin Knight, Goblin Pillager, Ogre"
#else
        recruit="Orcish Warrior, Orcish Grunt, Orcish Archer, Orcish Crossbowman, Orcish Pyro Archer, Orcish Shaman, Wolf Rider, Goblin Knight"
#endif
        {NO_ECONOMY}

        [ai]
            [goal]
                name="target"
                [criteria]
                    side=1
                [/criteria]
                value=0.10
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=2
                [/criteria]
                value=0.60
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=6
                [/criteria]
                value=0.30
            [/goal]
        [/ai]

    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Orcish Warrior" 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Goblin Knight" 3}

    {FORCE_CHANCE_TO_HIT (side=1,2,3,4,7,9,10,11,12,13) (id="Gushnak") 0 ()}

    [side]
        side=7
        team_name="good, rodents"
        user_team_name= _ "Woodlanders"
        id="Troombadoom"
        name= _ "Troombadoom"
        type="Ancient Wose"
        canrecruit=yes
        controller=ai
        {IS_EXPENDABLE_LEADER}
        fog=yes
        shroud=yes
        {FLAG_VARIANT wood-elvish}
        recruit="Faun, Faun Captain, Golem, Young Sasquatch, Elfin, Rodent Rider, Wose, Faerie Sprite"
        {GOLD 320 280 250}
        {INCOME 8 7 6}
        [ai]
            {EXPERIMENTAL_AI}
        [/ai]
    [/side]

    [side]
        side=8
        id="Grugar"
        name- _ "Grugar"
        type="Orcish Elite Warrior"
        canrecruit=yes
        controller=ai
        fog=yes
        shroud=yes
        {FLAG_VARIANT ragged}
        hidden=yes
        team_name="orcs"
        user_team_name= _ "Orcs"

        recruit="Orcish Grunt, Orcish Warrior, Orcish Archer, Orcish Pyro Archer, Orcish Shaman, Wolf Rider, Goblin Pillager"

        {GOLD 220 250 300}
        {INCOME 6 7 8}
        [ai]
            {EXPERIMENTAL_AI}
        [/ai]
    [/side]

    [side]
        side=9
        id="Kernix"
        name= _ "Kernix"
        type="Saurian Flanker"
        canrecruit=yes
        controller=ai
        fog=yes
        shroud=yes
        {FLAG_VARIANT ragged}
        hidden=yes
        team_name="lizards"
        user_team_name= _ "Saurians"
#ifdef HARD
        recruit="Saurian Skirmisher, Saurian Augur, Saurian Ambusher, Saurian Flanker, Saurian Oracle, Naga Fighter, Naga Warrior, Naga Hunter, Naga Assassin"
#else
        recruit="Saurian Skirmisher, Saurian Augur, Saurian Ambusher, Saurian Oracle, Naga Fighter, Naga Warrior, Naga Hunter"
#endif
        {NO_ECONOMY}

        [ai]
            [goal]
                name="target"
                [criteria]
                    side=1
                [/criteria]
                value=0.10
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=2
                [/criteria]
                value=0.60
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=6
                [/criteria]
                value=0.30
            [/goal]
        [/ai]

    [/side]

    {FORCE_CHANCE_TO_HIT (side=1,2,3,4,5,6,7,8,10,11,12,13) (id="Kernix") 0 ()}

    [side]
        side=10
        {CHARACTER_STATS_FARIA}
        x,y=38,57
        canrecruit=yes
        controller=ai
        fog=yes
        shroud=yes
        color=dark_purple
        {FLAG_VARIANT long}
        hidden=yes
        team_name="good, rodents"
        user_team_name= _ "Elementals"
        recruit="Wisp, Kobold, Stone Golem, Vine Beast, Vine Tiger, Ethereal Orb"
        {GOLD 280 250 220}
        {INCOME 6 5 4}
        [ai]
            {EXPERIMENTAL_AI}
        [/ai]
    [/side]

    [side]
        side=11
        id="Oworan"
        name= _ "Oworan"
        {IS_EXPENDABLE_LEADER}
        type="Red Mage"
        canrecruit=yes
        controller=ai
        x,y=41,11
        fog=yes
        color=navy_blue
        shroud=yes
        {FLAG_VARIANT long}
        team_name="good"
        hidden=yes
        user_team_name= _ "The Academy"
        recruit="Brazier Imp, Furnace Beast, Fire Wisp"
        {NO_ECONOMY}
        [ai]
            {EXPERIMENTAL_AI}
        [/ai]
    [/side]

    [side]
        side=12
        id="Lemyr"
        name= _ "Lemyr"
        {IS_EXPENDABLE_LEADER}
        type="Red Mage"
        canrecruit=yes
        controller=ai
        x,y=24,12
        fog=yes
        color=orchid
        shroud=yes
        {FLAG_VARIANT long}
        team_name="good"
        hidden=yes
        user_team_name= _ "The Academy"
        recruit="Brazier Imp, Furnace Beast, Fire Wisp"
        {NO_ECONOMY}
        [ai]
            {EXPERIMENTAL_AI}
        [/ai]
    [/side]

    [side]
        side=13
        color=rust
        team_name="rodents"
        hidden=yes
        no_leader=yes
        user_team_name= _ "Rodents"
        {NO_ECONOMY}

        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            version=10710
            [engine]
                name="lua"
                code= <<
                    local ai = ...
                    return wesnoth.require("ai/micro_ais/engines/priority_target_engine.lua").init(ai)
                >>
            [/engine]
            [modify_ai]
                side=13
                action=add
                # wmllint: unbalanced-on
                path=stage[main_loop].candidate_action[]
                # wmllint: unbalanced-off
                [candidate_action]
                    engine=lua
                    name=change_attacks_aspect
                    id=change_attacks_aspect
                    max_score=999999
                    evaluation="return (...):change_attacks_aspect('Jahin')"
                    execution="(...):change_attacks_aspect()"
                [/candidate_action]
            [/modify_ai]
        [/ai]
    [/side]

    [event]
        name="prestart"

# clear previous variables
# which are not required

        {CLEAR_VARIABLE Kojac_rescued}

# recall your party

        {RECALL "Meherab"}
        {RECALL "Mahir"}
        {RECALL "Krog"}
        {RECALL "rider1"}
        {RECALL "rider2"}

# initialise variables

        {VARIABLE enemies_defeated 0}
        {VARIABLE phase_two_triggered no}
        {VARIABLE ring_taken no}

# store the main battle leaders

        [store_unit]
            [filter]
                id="Alynoic"
            [/filter]
            kill=yes
            variable="stored.alynoic"
        [/store_unit]

        [store_unit]
            [filter]
                id="Wendell"
            [/filter]
            kill=yes
            variable="stored.wendell"
        [/store_unit]

        [store_unit]
            [filter]
                id="Gushnak"
            [/filter]
            kill=yes
            variable="stored.gushnak"
        [/store_unit]

        [store_unit]
            [filter]
                id="Kernix"
            [/filter]
            kill=yes
            variable="stored.kernix"
        [/store_unit]

        [store_unit]
            [filter]
                id="Lemyr"
            [/filter]
            kill=yes
            variable="stored.lemyr"
        [/store_unit]
 
        [store_unit]
            [filter]
                id="Oworan"
            [/filter]
            kill=yes
            variable="stored.oworan"
        [/store_unit]

# place that special item

        {PLACE_IMAGE "items/ring-silver.png" 14 53}

# place the captured Crylix

        {PLACE_IMAGE "units/saurians/skirmisher/skirmisher.png~RC(magenta>steel_blue)" 20 23}
        {PLACE_IMAGE "items/cage.png" 20 23}

# place the guardian units

        {LOYAL_UNIT 6 "Orcish Warrior" 19 24}{FACING sw}
        {GUARDIAN}

        {LOYAL_UNIT 6 "Orcish Pyro Archer" 21 24}{FACING se}
        {GUARDIAN}

        {LOYAL_UNIT 6 "Orcish Juggernaut"  9 31}{GUARDIAN}
        {LOYAL_UNIT 6 "Orcish Warrior"  5 31}{GUARDIAN}
        {LOYAL_UNIT 6 "Orcish Slurbow" 10 30}{GUARDIAN}
        {LOYAL_UNIT 6 "Orcish Elite Warrior" 13 30}{GUARDIAN}

        {LOYAL_UNIT 2 "Lava Giant"  7 10}{GUARDIAN}
        {LOYAL_UNIT 2 "Lava Giant"  9 10}{GUARDIAN}
        {LOYAL_UNIT 2 "Lava Giant"  6 11}{GUARDIAN}
        {LOYAL_UNIT 2 "Lava Giant" 10 11}{GUARDIAN}
        {LOYAL_UNIT 2 "Lava Giant"  7 13}{GUARDIAN}
        {LOYAL_UNIT 2 "Lava Giant"  9 13}{GUARDIAN}

        {LOYAL_UNIT 2 "Stone Golem" 38  5}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 40  6}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 39  7}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 42  7}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 44  8}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 45  8}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 46  9}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 46 11}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 45 10}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 45 16}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 46 14}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 45 14}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 43 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 42 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 42 16}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 40 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 38 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 35 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 34 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 33 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 30 17}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 27 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 26 17}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 24 15}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 22 14}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 21 13}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 21 11}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 21 8}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 26 6}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 28 5}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 31  5}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 34  4}{GUARDIAN}

# Set initial objectives

        [objectives]
            side=1
            [objective]
                description= _ "Explore the forest"
                condition="win"
            [/objective]

            [objective]
                description= _ "Death of Jahin"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of any hero unit"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Kojac"
                condition="lose"
            [/objective]
            {TURNS_RUN_OUT}
            
            [gold_carryover]
                carryover_percentage=0
                bonus=no
            [/gold_carryover]
        [/objectives]
    [/event]

# Start

    [event]
        name="start"

        {SCROLL_TO_UNIT "Jahin"}

        {SIMPLE_MESSAGE "Jahin" ( _ "We have arrived at the edge of another forest, which appears to be denser than the last one. I suggest that we begin exploring as a group for we do not know what enemy might attack us.")}

        {SIMPLE_MESSAGE "Meherab" ( _ "What if we encounter vampires here?")}

        {SIMPLE_MESSAGE "Jahin" ( _ "That is highly improbable however, we shall fight them if they dare show their faces here.")}
    [/event]    

# Rodent Spawner
# This is for XP

    [event]
        name="turn 2, turn 7, turn 12, turn 17, turn 22, turn 27, turn 32"
        first_time_only=no

        {GENERIC_UNIT 13 "Giant Rat"  1 47}
        {GENERIC_UNIT 13 "Giant Rat"  1 55}
        {GENERIC_UNIT 13 "Giant Rat" 24 75}
        {GENERIC_UNIT 13 "Giant Rat" 46 75}
        {GENERIC_UNIT 13 "Giant Rat" 48 70}
        {GENERIC_UNIT 13 "Giant Rat" 48 53}
    [/event]

# Naga wave spawner
# only active when phase two is triggered

    [event]
        name="turn 17 ,turn 22, turn 27, turn 32, turn 37, turn 42, turn 47, turn 52"
        first_time_only=no

        [if]
            {VARIABLE_CONDITIONAL phase_two_triggered equals yes}
            [then]
            
                {RANDOM 1..4}

                [switch]
                    variable=random

                    [case]
                        value=1

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  1  1}
                        {GENERIC_UNIT 9 "Saurian Augur"  7  1}
                        {GENERIC_UNIT 9 "Saurian Skirmisher" 27  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  3  2}
                        {GENERIC_UNIT 9 "Naga Fighter"  8  1}
                        {GENERIC_UNIT 9 "Saurian Ambusher" 33  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher" 20  2}
                        {GENERIC_UNIT 9 "Naga Guardian" 37  1}
                        {GENERIC_UNIT 9 "Naga Warrior" 39  1}
                    [/case]

                    [case]
                        value=2

                        {GENERIC_UNIT 9 "Saurian Ambusher"  1  1}
                        {GENERIC_UNIT 9 "Saurian Augur"  7  1}
                        {GENERIC_UNIT 9 "Saurian Oracle" 27  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  3  2}
                        {GENERIC_UNIT 9 "Naga Warrior"  8  1}
                        {GENERIC_UNIT 9 "Saurian Ambusher" 33  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher" 20  2}
                        {GENERIC_UNIT 9 "Naga Warden" 37  1}
                        {GENERIC_UNIT 9 "Naga Warrior" 39  1}
                    [/case]

                    [case]
                        value=3

                        {GENERIC_UNIT 9 "Saurian Soothsayer"  1  1}
                        {GENERIC_UNIT 9 "Saurian Augur"  7  1}
                        {GENERIC_UNIT 9 "Saurian Skirmisher" 27  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  3  2}
                        {GENERIC_UNIT 9 "Naga Assassin"  8  1}
                        {GENERIC_UNIT 9 "Saurian Ambusher" 33  1}

                        {GENERIC_UNIT 9 "Saurian Flanker" 20  2}
                        {GENERIC_UNIT 9 "Naga Sentinel" 37  1}
                        {GENERIC_UNIT 9 "Naga Warrior" 39  1}
                    [/case]

                    [case]
                        value=4

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  1  1}
                        {GENERIC_UNIT 9 "Saurian Oracle"  7  1}
                        {GENERIC_UNIT 9 "Saurian Augur" 27  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  3  2}
                        {GENERIC_UNIT 9 "Naga Fighter"  8  1}
                        {GENERIC_UNIT 9 "Saurian Ambusher" 33  1}

                        {GENERIC_UNIT 9 "Saurian Flanker" 20  2}
                        {GENERIC_UNIT 9 "Naga Guardian" 37  1}
                        {GENERIC_UNIT 9 "Naga Myrmidon" 39  1}
                    [/case]
                [/switch]

                {CLEAR_VARIABLE random}
            [/then]
        [/if]
    [/event]

# The death events

    {MAIN_HERO_DEATH_EVENTS}
    {MAHIR_DEATH_EVENT}
    {FARIA_DEATH_EVENT}
    {KOJAC_DEATH_EVENT_1}

    [event]
        name="last breath"

        [filter]
            id="Alynoic"
        [/filter]

        {SIMPLE_MESSAGE "unit" ( _ "With my death, the Academy falls!")}
    [/event]

    [event]
        name="die"

        [filter]
            id="Alynoic"
        [/filter]

        {ENDLEVEL_DEFEAT}
    [/event]

    [event]
        name="last breath"

        [filter]
            id="Troombadoom"
        [/filter]

        {SIMPLE_MESSAGE "unit" ( _ "Alas, I have failed to protect the forest!")}
    [/event]

    [event]
        name="last breath"

        [filter]
            id="Grugar"
        [/filter]

        {SIMPLE_MESSAGE "Meherab" ( _ "Die, you filthy orc!")}
    [/event]

    [event]
        name="die"

        [filter]
            id="Grugar"
        [/filter]

        {VARIABLE_OP enemies_defeated add 1}

        [if]
            {VARIABLE_CONDITIONAL enemies_defeated equals 3}
                [then]
                    [fire_event]
                        name="activate_phase_two"
                    [/fire_event]
                [/then]
                [else]
#ifdef EASY
                    {LOOT 70 1}
#endif
#ifdef NORMAL
                    {LOOT 60 1}
#endif
#ifdef HARD
                    {LOOT 50 1}
#endif
                [/else]
        [/if]
    [/event]

    [event]
        name="last breath"

        [filter]
            id="Gridash"
        [/filter]

        {SIMPLE_MESSAGE "Krog" ( _ "Orc deserves death for brutal deeds orc had done!")}
    [/event]

    [event]
        name="die"

        [filter]
            id="Gridash"
        [/filter]

        {VARIABLE_OP enemies_defeated add 1}

        [if]
            {VARIABLE_CONDITIONAL enemies_defeated equals 3}
                [then]
                    [fire_event]
                        name="activate_phase_two"
                    [/fire_event]
                [/then]
                [else]
#ifdef EASY
                    {LOOT 70 1}
#endif
#ifdef NORMAL
                    {LOOT 60 1}
#endif
#ifdef HARD
                    {LOOT 50 1}
#endif
                [/else]
        [/if]
    [/event]

    [event]
        name="last breath"

        [filter]
            id="Kern"
        [/filter]

        {SIMPLE_MESSAGE "Mahir" ( _ "It feels good to see a vampire die!")}
        {SIMPLE_MESSAGE "Meherab" ( _ "Aren't vampires already dead?")}
        {SIMPLE_MESSAGE "Mahir" ({ASIDE ( _ "Well, then it still feels good to see this one die again!")})}
    [/event]

    [event]
        name="die"

        [filter]
            id="Kern"
        [/filter]

        {VARIABLE_OP enemies_defeated add 1}

        [if]
            {VARIABLE_CONDITIONAL enemies_defeated equals 3}
                [then]
                    [fire_event]
                        name="activate_phase_two"
                    [/fire_event]
                [/then]
                [else]
#ifdef EASY
                    {LOOT 70 1}
#endif
#ifdef NORMAL
                    {LOOT 60 1}
#endif
#ifdef HARD
                    {LOOT 50 1}
#endif
                [/else]
        [/if]
    [/event]

# Phase One Activation

    [event]
        name="moveto"
        first_time_only=yes

        [filter]
            side=1
            [filter_location]
                x,y=35,70
                radius=10
            [/filter_location]
        [/filter]

        {CLEAR_FOG 1 35 70 3}

        [remove_shroud]
             side=1
             x=33-37
             y=68-72
        [/remove_shroud]

        [unit]
             side=1
             x,y=35,70
             {CHARACTER_STATS_MALIHA}
#ifdef EASY
             experience=12
#endif
        [/unit]

        {CAPTURE_VILLAGES 1 35 70 1}

        {SIMPLE_MESSAGE "Maliha" ( _ "Wait, enter the forest at your own peril!")}

        {SIMPLE_MESSAGE "Meherab" ( _ "Why? Is something wrong?")}

        {SIMPLE_MESSAGE "Maliha" ( _ "Orcs and vampires roam the forest with unknown motives. My friends are trying to rout them, but their attempts have been unsuccessful. Leave now, before the orcs or vampires detect your presence.")}

        {SIMPLE_MESSAGE "Mahir" ( _ "Vampires? Yay! I get to kill some blood-suckers!")}

        {SIMPLE_MESSAGE "Jahin" ( _ "Vampires? Well, we are no friends of theirs. May we join the fight?")}

        {SIMPLE_MESSAGE "Krog" ( _ "Krog ready to kill orcs and vampires!")}

        {SIMPLE_MESSAGE "Maliha" ( _ "You all sound persistent and I shall help you guys out then. By the way, my name is Maliha.")}

        {SIMPLE_MESSAGE "Jahin" ( _ "Nice to meet you too, Maliha. My name is Jahin and these my companions - Mahir, Meherab, Krog and Kojac.")}

        {SIMPLE_MESSAGE "Maliha" ( _ "Well met, friend. However, I'm afraid introductions have to wait. My friend is nearby, fighting the vampires whilst my other friend is rallying the protectors of the forest to engage the orcs.")}

        {SIMPLE_MESSAGE "Mahir" ( _ "Protectors of the forest?")}

        {SIMPLE_MESSAGE "Maliha" ( _ "They call themselves the <i>Woodlanders</i> and I have a feeling that you will be meeting them soon,")}

        [objectives]
            side=1
            [objective]
                description= _ "Defeat the orcs and vampires"
                condition="win"
            [/objective]

            [objective]
                description= _ "Death of Jahin"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of any hero unit"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Kojac"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of any non-expendable allied leader"
                condition="lose"
            [/objective]
            {TURNS_RUN_OUT}
            
            [gold_carryover]
                carryover_percentage=0
                bonus=no
            [/gold_carryover]
        [/objectives]
    [/event]

# Phase Two Activation

    [event]
        name="activate_phase_two"

        {CLEAR_VARIABLE enemies_defeated}

        {VARIABLE phase_two_triggered yes}

        {REPLACE_SCENARIO_MAP_DATA 1 02B_Towards_the_North}

        {SIMPLE_MESSAGE "Jahin" ( _ "We have rid the forest of enemies!")}
        
        {SIMPLE_MESSAGE "Faria" ( _ "Thank you for your help, Jahin. Are you heading towards the Academy?")}

        {SIMPLE_MESSAGE "Jahin" ( _ "The Academy? What are you talking about?")}

        {SIMPLE_MESSAGE "Faria" ( _ "It's a human stronghold situated north of here, prominent for its lore on Elemental magic.")}

        {SIMPLE_MESSAGE "Jahin" ( _ "If the Academy helps us to reclaim our city from the vampires, then we might go there.")}

        {SIMPLE_MESSAGE "Maliha" ( _ "I don't know if they would be willing to help you, but that's the only place you can go without getting killed.")}

        {SIMPLE_MESSAGE "Mahir" ( _ "Why is that?")}

        {SIMPLE_MESSAGE "Maliha" ( _ "Most of the North is a vast desert dominated by dragon-like creatures called Drakes and their xenophobic nature could instigate them to attack you on sight. If you go northeast, you might encounter either vampires or saurians.")}

        {SIMPLE_MESSAGE "Mahir" ( _ "<i>(excited)</i> Then let's get going. The Academy awaits our arrival!")}

        {SIMPLE_MESSAGE "Maliha" ( _ "I shall join you on your journey. It should be fun!")}

        {SIMPLE_MESSAGE "Faria" ( _ "I suppose I should help you all get there in one piece for there might more vampires and orcs.")}

        {MODIFY_UNIT (side=10) side 1}
        
        [allow_recruit]
            side=1
            recruit="Wisp, Kobold, Vine Beast"
        [/allow_recruit]

        {TRANSFER_VILLAGE_OWNERSHIP 10 1}

        [objectives]
            side=1
            [objective]
                description= _ "Move Jahin to the vicinity of the Academy's Keep (08,11)"
                condition="win"
            [/objective]
            [objective]
                {BONUS_OBJECTIVE_CAPTION}
                description= _ "Explore and rescue any trapped units"
                condition="win"
            [/objective]

            [objective]
                description= _ "Death of Jahin"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of any hero unit"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Alynoic"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Kojac"
                condition="lose"
            [/objective]
            {TURNS_RUN_OUT}
            
            [gold_carryover]
                carryover_percentage=50
                bonus=yes
            [/gold_carryover]

            [note]
                description= _ "HINT:
You can recruit units now.
Try to level up a few units before advancing to the next scenario."
            [/note]

        [/objectives]

        [modify_side]
            side=1
            {GOLD 70 60 50}
            {INCOME 4 3 2}
            village_gold=1
        [/modify_side]

        [unstore_unit]
            variable=stored.alynoic
        [/unstore_unit]
        [unstore_unit]
            variable=stored.wendell
        [/unstore_unit]
        [unstore_unit]
            variable=stored.gushnak
        [/unstore_unit]
        [unstore_unit]
            variable=stored.kernix
        [/unstore_unit]
        [unstore_unit]
            variable=stored.lemyr
        [/unstore_unit]
        [unstore_unit]
            variable=stored.oworan
        [/unstore_unit]

        [modify_side]
            side=2
            village_gold=1
            {INCOME 20 18 16}
            {GOLD 400 380 360}
        [/modify_side]

        [modify_side]
            side=3
            village_gold=1
            {INCOME 20 18 16}
            {GOLD 300 280 260}
        [/modify_side]

        [modify_side]
            side=6
            village_gold=1
            {INCOME 20 18 16}
            {GOLD 300 280 260}
        [/modify_side]

        [modify_side]
            side=9
            village_gold=1
            {INCOME 20 18 16}
            {GOLD 500 480 460}
        [/modify_side]

        [modify_side]
            side=11
            village_gold=1
            {INCOME 20 18 16}
            {GOLD 200 180 160}
        [/modify_side]
    
        [modify_side]
            side=12
            village_gold=1
            {INCOME 20 18 16}
            {GOLD 200 180 160}
        [/modify_side]

        [micro_ai_fast]
            side=2
            ai_type=fast_ai
            action=add
            dungeon_mode=no
        [/micro_ai_fast]

        [micro_ai_fast]
            side=3
            ai_type=fast_ai
            action=add
            dungeon_mode=no
        [/micro_ai_fast]

        [micro_ai_fast]
            side=6
            ai_type=fast_ai
            action=add
            dungeon_mode=no
        [/micro_ai_fast]

        [micro_ai_fast]
            side=9
            ai_type=fast_ai
            action=add
            dungeon_mode=no
        [/micro_ai_fast]

        {CLEAR_VARIABLE stored}
    [/event]

# Main victory condition

    [event]
        name="moveto"
        first_time_only=yes
 
        [filter]
            id="Jahin"
            [filter_location]
                x,y= 8,11
                radius=4
            [/filter_location]
        [/filter]

        [if]
             {VARIABLE_CONDITIONAL phase_two_triggered equals yes}
             [then]

                 {SIMPLE_MESSAGE "Alynoic" ( _ "Hey, who are you?")}

                 {SIMPLE_MESSAGE "Jahin" ( _ "My name is Jahin and these are my friends. We have come from the vampire-occupied human city that is situated south from here. We seek an audience with your leader.")}

                 {SIMPLE_MESSAGE "Alynoic" ( _ "We have come to seek asylum? Very well, come inside.")}

                 [endlevel]
                     result=victory
                     bonus=yes
                     {NEW_GOLD_CARRYOVER 50}
                 [/endlevel]
             [/then]
        [/if]
    [/event]

# Crylix

    [event]
        name="moveto"
        first_time_only=yes

        [filter]
            side=1
            x,y=20,23
        [/filter]

        [unit]
            side=1
            x,y=20,23
            {CHARACTER_STATS_CRYLIX}
        [/unit]

        {SIMPLE_MESSAGE "Crylix" ( _ "Thank you, humansss. You have liberated me and for that I am grateful. Allow me to join you in your questsss.")}

        {SIMPLE_MESSAGE "Meherab" ( _ "You are most welcome, friend. We accept your offer. Do you have a name?")}

        {SIMPLE_MESSAGE "Crylix" ( _ "I am Crylix, son of Lazki.")}

    [/event]

# Ring of the Warrior

    [event]
        name="moveto"
        first_time_only=no

        [filter]
            side=1
            x,y=14,53
        [/filter]

        [filter_condition]
            {VARIABLE ring_taken no}
        [/filter_condition]

        [item_dialog]
             name= _ "Ring of the Warrior"
             image="icons/stone_ring.png"
             description= _ "These ring bears the markings of an ancient civilisation. However, you deduce that one of the diminutive patterns resembles a sword; implying that its original bearer was a renowned fighter and now, the ring seeks a new one."
             effect= _ "This ring grants a +1 bonus to melee damage. Choose its wearer carefully."
             variable=ring_taken
        [/item_dialog]

        [if]
            {VARIABLE_CONDITIONAL ring_taken equals yes}
            [then]
                {REMOVE_IMAGE 14 53}

                [object]
                    id="ring_of_the_warrior"
                    name= _ "Ring of the Warrior"
                    image="icons/stone_ring.png"
                    duration=forever
                    description= _ "Equipping this ring grants you a +1 melee damage bonus."
                    [effect]
                        apply_to=attack
                        range=melee
                        increase_damage=1
                    [/effect]
                [/object]
            [/then]
            [else]
                [allow_undo]
                [/allow_undo]
            [/else]
        [/if]
    [/event]

# sighting events

    {ON_SIGHTING one 1 (id="Faria") (
        {SIMPLE_MESSAGE "Maliha" ( _ "Hey, Faria, I have brought some help!")}
       
        {SIMPLE_MESSAGE "Faria" ( _ "That's good news for there are plenty of vampires and orcs to kill.")}

        {SIMPLE_MESSAGE "Jahin" ( _ "Why are the vampires and orcs attacking this forest? I know that the orcs will attack almost anything they perceive as an enemy however, the vampires do not attack without a purpose.")}

        {SIMPLE_MESSAGE "Faria" ( _ "For a mercenary, you inquire too much.")}

        {SIMPLE_MESSAGE "Jahin" ( _ "I am not a mercenary. My name is Jahin and these are my friends. We have come here as escapees from the vampire-occupied city, established due south from here.")}

        {SIMPLE_MESSAGE "Faria" ( _ "Oh, I see. Well, my name is Faria and I'm trying to defend this forest from the vampires and orcs. Can the formal introductions wait?")}

        {SIMPLE_MESSAGE "Jahin" ( _ "I have no problem with that. Just point us towards our adversaries...")}

        {SIMPLE_MESSAGE "Faria" ( _ "The vampire camp is northeast from here and there are two orcish campsites: one is due west and the other is northwestwards.")}
     )}

    {ON_SIGHTING two 1 (race="woodlander") (

        {SIMPLE_MESSAGE "unit" ( _ "Hey, are you a member of the Woodlanders?")}

        {SIMPLE_MESSAGE "second_unit" ( _ "Yes, I am one of the many protectors of the forest.")}

    )}

    {ON_SIGHTING three 1 (id="Troombadoom") (

        {SIMPLE_MESSAGE "Troombadoom" ( _ "Greetings, young ones. What brings you to this ancient forest?")}

        {SIMPLE_MESSAGE "Jahin" ( _ "We just passing through, ancient one. However, we would not mind fighting a few orcs or vampires along the way.")}

        {SIMPLE_MESSAGE "Troombadoom" ( _ "I sense potential in you, Boy. I shall share some information with you. There is a treasure northeastwards from my current location. You shall find it on an island.")}
    )}

    {ON_SIGHTING four 1 (race="vampire") (

        {SIMPLE_MESSAGE "Mahir" ( _ "Vampire!")}

        {SIMPLE_MESSAGE "second_unit" ( _ "Look, those are humans! They must be escapees from Verdanyn. Capture them!")}
    )}

    {ON_SIGHTING four 1 (race="elemental") (

        {SIMPLE_MESSAGE "Meherab" ( _ "Wow, what a fascinating creature!")}

        {SIMPLE_MESSAGE "Maliha" ( _ "That is an elemental construct, summoned by a mage versed well in conjuration magic. There are many different types of elementals, each grouped into any one of the four elements: fire, earth, water and air. However, necromancy is a form of conjuration magic that is forbidden.")}
    )}

    {ON_SIGHTING four 1 (race="orc") (

        {SIMPLE_MESSAGE "Mahir" ( _ "Look, there is an orc! Let's kill him!")}
    )}

[/scenario]