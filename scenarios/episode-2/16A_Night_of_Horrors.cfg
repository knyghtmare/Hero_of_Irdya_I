#textdomain wesnoth-Hero_of_Irdya_I

[scenario]
    id="16A_Night_of_Horrors"
    name= _ "Night of Horrors"

    victory_when_enemies_defeated=no

    {SCENARIO_MAP_DATA 2 16A_Night_of_Horrors}
    {NEXT_SCENARIO null}

    {TURNS 50 50 50}
    {TIME_OVER_DEFEAT}

    # perpetually night
    {RAIN_FIRST_WATCH}
    {RAIN_SECOND_WATCH}
    {HOI_WEATHER_HEAVY_RAIN}

    #{STORY_TEXT_SCENARIO_19}

    [side]
        side=1
        {CHARACTER_STATS_JAHIN}
        canrecruit=yes
        controller=human
        {FLAG_VARIANT loyalist}
        team_name="good"
        user_team_name= _ "Verdanyn"
        fog=yes
        shroud=yes
        share_vision=all
        {GOLD 350 300 280}
        {INCOME 3 2 1}
    [/side]

    {STARTING_VILLAGES 1 6}

    [side]
        side=2
        id="Undead_Commander"
        generic_name=yes
        canrecruit=yes
        controller=ai
        hitpoints={ON_DIFFICULTY 120 150 180}
        max_hitpoints={ON_DIFFICULTY 120 150 180}
        type="Elder Lich Lord"
        {FLAG_VARIANT undead}
        team_name="evil"
        user_team_name= _ "Evil"
        {GOLD 1400 1600 1900}
        {INCOME 18 21 25}

        recruit="Dark Invader, Bone Knight, Chocobone, Revenant, Deathblade, Death Baron, Bone Shooter, Cloud of Gloom, Howling Darkness, Soul Snatcher, Draug, Banebow, Death Knight, Eternal Night, Death Spectre, Unhatched, Angry One, Raging One, Rash One, Reckless One, Jinx Beast, Spiteful Watcher, Scornful Watcher, Life Thief"
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 1.00}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0.00}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 20.00}
        [/ai]
    [/side]

    {STARTING_VILLAGES 2 7}

    [side]
        side=3
        id="Alynoic"
        name= _ "female^Alynoic"
        gender=female
        type="Great Mage"
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT long}
        team_name="good"
        user_team_name= _ "The Academy"
        recruit="Brazier Imp, Furnace Beast, Fire Wisp, Kobold, Stone Golem, Razorbird, Thunderbird, Wisp, Ethereal Orb, Sylph, Zephyr, Ice Crab, Tidal, Undine, Mage, White Mage, Red Mage"
        village_gold=1
        {INCOME 20 18 16}
        {GOLD 400 380 360}

        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT grouping defensive}
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.20}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0.80}
        [/ai]
    [/side]

    {STARTING_VILLAGES 3 9}

    [event]
        name="last breath"

        [filter]
            id="Alynoic"
        [/filter]

        {SIMPLE_MESSAGE "unit" ( _ "With my death, the Academy falls!")}
    [/event]

    [event]
        name="die"

        [filter]
            id="Alynoic"
        [/filter]

        {ENDLEVEL_DEFEAT}
    [/event]

    [side]
        side=4
        id="Orc_Chief16"
        generic_name=yes
        canrecruit=yes
        controller=ai
        type="Orcish Warlord"
        {FLAG_VARIANT ragged}

        team_name="orcs"
        user_team_name= _ "Northerners"

        {GOLD 600 800 1200}
        {INCOME 13 18 23}

        recruit="Ogre, Orcish Raider, Orcish Warrior, Orcish Crossbowman, Orcish Slayer, Orcish Pyro Archer, Goblin Lancer, Goblin Pillager, Goblin Knight"
    [/side]

    {STARTING_VILLAGES 4 6}

    [side]
        side=5
        team_name="good"
        user_team_name= _ "Woodlanders"
        id="Woodlander_Leader"
        generic_name=yes
        type="Faun Lord"
        canrecruit=yes
        controller=ai
        {IS_EXPENDABLE_LEADER}
        {FLAG_VARIANT wood-elvish}
        recruit="Faun Marksman, Faun Captain, Golem, Young Sasquatch, Elfin, Rodent Rider, Toxic Plant, Banebush, Wose, Faerie Sprite"
        {GOLD 520 500 500}
        {INCOME 22 18 13}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT grouping defensive}
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.66}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 0.0}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0.33}

            [goal]
                name=protect_unit
                [criteria]
                    id="Woodlander_Leader"
                [/criteria]
                protect_radius=8
                value=5
            [/goal]
        [/ai]
    [/side]

    {STARTING_VILLAGES 5 10}

    [side]
        side=6
        id="Undead_Commander2"
        generic_name=yes
        canrecruit=yes
        controller=ai
        type="Lich"
        {FLAG_VARIANT undead}
        team_name="evil"
        user_team_name= _ "Evil"
        {GOLD 100 150 250}
        {INCOME 8 11 15}

        recruit="Life Thief, Howling Darkness, Cloud of Gloom, Soul Snatcher, Unhatched, Rash One, Angry One, Black Cat, Jinx Beast, Sylph, Zephyr"
    [/side]

    [side]
        side=7
        id="Ally_leader1"
        generic_name=yes
        {IS_EXPENDABLE_LEADER}
        type="Elder Mage"
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT long}
        team_name="good"
        hidden=yes
        user_team_name= _ "The Academy"
        recruit="Stone Golem, Kobold, Vine Beast, Vine Tiger"
        {GOLD 80 120 150}
        {INCOME 8 11 15}
    [/side]

    [side]
        side=8
        id="Ally_leader2"
        generic_name=yes
        {IS_EXPENDABLE_LEADER}
        type="Tempest Mage"
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT long}
        team_name="good"
        hidden=yes
        user_team_name= _ "The Academy"
        recruit="Razorbird, Sylph, Zephyr, Thunderbird"
        {GOLD 80 120 150}
        {INCOME 8 11 15}
    [/side]

    # side 9

    [side]
        side=9
        no_leader=yes
        controller=ai
        color=khaki
        team_name="good"
        user_team_name= _ "Verdanyn"
        fog=yes
        shroud=yes
        share_vision=all
        {FLAG_VARIANT loyalist}

#ifdef EASY
        recruit="Outlaw, Trapper, Bandit, Huntress, Thug, Poacher, Footpad, Tracker"
#endif
#ifdef NORMAL
        recruit="Outlaw, Huntress, Thug, Poacher, Footpad, Tracker"
#endif
#ifdef HARD
        recruit="Thug, Poacher, Footpad, Tracker"
#endif

        {GOLD 150 120 80}
        # I just want the side to 'exist'
        {INCOME 18 13 8}

        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT grouping defensive}
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.33}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0.66}

            # This AI shall have three goals
            # Ensure base is protected
            # Ensure their leader is stays safe
            # Ensure their hero unit stays safe

            [goal]
                name=protect_location
                [criteria]
                    x,y=39,74
                [/criteria]
                protect_radius=16
                value=5
            [/goal]
            [goal]
                name=protect_unit
                [criteria]
                    id="Mahir"
                [/criteria]
                protect_radius=8
                value=5
            [/goal]
            [goal]
                name=protect_unit
                [criteria]
                    id="Meherab"
                [/criteria]
                protect_radius=8
                value=5
            [/goal]
        [/ai]
    [/side]

    # prestart

    [event]
        name="prestart"

        {RECALL "Abrar"}
        {RECALL "Mahir"}
        {RECALL "Krog"}
        {RECALL "Meherab"}

        {RECALL "Fah Ra Din"}
        {RECALL "Kojac"}
        {RECALL "Crylix"}
        {RECALL "rider1"}
        {RECALL "rider2"}
        {RECALL "Nog"}
        {RECALL "soldier"}
        {RECALL "soldier2"}
        {RECALL "Varawiel"}
        {RECALL "Sylwester"}
        {RECALL "Loyal_Ghost"}

        {SCATTER_UNITS {ON_DIFFICULTY 45 60 75} "Black Cat, Jinx Beast, Calamity, Unhatched, Angry One, Raging One, Rash One, Reckless One, Inquisitor, Scornful Watcher, Spiteful Watcher, Life Thief, Soul Snatcher, Soul Spectre, Howling Darkness, Cloud of Gloom, Eternal Night" 5 (
            terrain=Gg
            x= 1-75
            y=20-75

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=2
            generate_name=yes
            random_traits=yes
        )}

        {SCATTER_UNITS {ON_DIFFICULTY 20 25 30} "Furnace Beast, Fire Wisp, Stone Golem, Zephyr, Vine Tiger, Vine Beast, Brazier Imp, Kobold, Sylph, Razorbird, Thunderbird" 5 (
            terrain=Gg
            x=21-75
            y=9-27

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=3
            generate_name=yes
            random_traits=yes
        )}

        {SCATTER_UNITS {ON_DIFFICULTY 40 35 32} "Faun Marksman, Faun Captain, Golem, Young Sasquatch, Sasquatch, Elfin, Rodent Rider, Rodent Predator, Toxic Plant, Banebush, Wose, Elder Wose, Faerie Sprite, Fire Faerie" 5 (
            terrain=Gs^Ft
            x= 1-75
            y=36-75

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=5
            generate_name=yes
            random_traits=yes
        )}

        {SCATTER_UNITS {ON_DIFFICULTY 32 38 45} "Orcish Grunt, Orcish Raider, Orcish Warrior, Orcish Archer, Orcish Crossbowman, Orcish Pyro Archer, Orcish Shaman, Orcish Warlock, Orcish Assassin, Orcish Slayer, Young Ogre, Ogre, Goblin Impaler, Goblin Spearmaster, Goblin Rouser, Goblin Cavalry, Goblin Lancer, Goblin Knight, Wolf Rider, Goblin Pillager" 5 (
            terrain=Gg
            x=21-75
            y=19-61

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=4
            generate_name=yes
            random_traits=yes
        )}

        {LOYAL_UNIT 4 "Orcish Juggernaut"  9 31}{GUARDIAN}
        {LOYAL_UNIT 4 "Orcish Warrior"  5 31}{GUARDIAN}
        {LOYAL_UNIT 4 "Orcish Slurbow" 10 30}{GUARDIAN}
        {LOYAL_UNIT 4 "Orcish Elite Warrior" 13 30}{GUARDIAN}

        {LOYAL_UNIT 3 "Lava Giant"  7 10}{GUARDIAN}
        {LOYAL_UNIT 3 "Lava Giant"  9 10}{GUARDIAN}
        {LOYAL_UNIT 3 "Lava Giant"  6 11}{GUARDIAN}
        {LOYAL_UNIT 3 "Lava Giant" 10 11}{GUARDIAN}
        {LOYAL_UNIT 3 "Lava Giant"  7 13}{GUARDIAN}
        {LOYAL_UNIT 3 "Lava Giant"  9 13}{GUARDIAN}

        {LOYAL_UNIT 3 "Stone Golem" 38  5}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 40  6}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 39  7}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 42  7}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 44  8}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 45  8}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 46  9}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 46 11}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 45 10}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 45 16}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 46 14}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 45 14}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 43 18}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 42 18}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 42 16}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 40 18}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 38 18}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 35 18}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 34 18}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 33 18}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 30 17}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 27 18}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 26 17}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 24 15}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 22 14}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 21 13}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 21 11}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 21 8}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 26 6}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 28 5}{GUARDIAN}
        {LOYAL_UNIT 3 "Stone Golem" 31  5}{GUARDIAN}
        {LOYAL_UNIT 3 "Furnace Beast" 34  4}{GUARDIAN}

        {LOYAL_UNIT 5 "Elder Wose"  5 71}{GUARDIAN}
        {LOYAL_UNIT 5 "Elder Wose"  3 72}{GUARDIAN}
        {LOYAL_UNIT 5 "Elder Wose"  3 74}{GUARDIAN}
        {LOYAL_UNIT 5 "Elder Wose"  7 73}{GUARDIAN}

        # micro AI

        [micro_ai]
            side=2
            ai_type=fast_ai
            action=add
            dungeon_mode=no
        [/micro_ai]
        [micro_ai]
            side=2
            ai_type=recruit_random
            action=add
            skip_low_gold_recruiting=yes
        [/micro_ai]
        [micro_ai]
            side=3
            ai_type=fast_ai
            action=add
            dungeon_mode=no
        [/micro_ai]
        [micro_ai]
            side=3
            ai_type=recruit_random
            action=add
            skip_low_gold_recruiting=yes
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=fast_ai
            action=add
            dungeon_mode=no
        [/micro_ai]
        [micro_ai]
            side=4
            ai_type=recruit_random
            action=add
            skip_low_gold_recruiting=yes
        [/micro_ai]
        [micro_ai]
            side=5
            ai_type=fast_ai
            action=add
            dungeon_mode=no
        [/micro_ai]
        [micro_ai]
            side=5
            ai_type=recruit_random
            action=add
            skip_low_gold_recruiting=yes
        [/micro_ai]
    [/event]

    # start

    [event]
        name="start"

        {SIMPLE_MESSAGE "Jahin" ( _ "What is going on here? We seemed to have arrived at a battlefield.")}

        {SIMPLE_MESSAGE "Mahir" ( _ "This certainly explains why reinforcements haven't been coming to us. They have been getting beset by aberrants and undead.")}

        {SIMPLE_MESSAGE "Jahin" ( _ "I am a bit puzzled right now. These lands were firmly under alliance control. How did so many of these malicious creatures get here?")}

        {SIMPLE_MESSAGE "Meherab" ( _ "I do not know. I think you should investigate the vicinity. Maybe head to the Academy to see what is going on? They may know something.")}

        {SIMPLE_MESSAGE "Mahir" ( _ "While you do that, Meherab and I shall rally the troops. Many of us have decided to join you in this excursion.")}

        # transfer Mahir and Meherab to side 9

        {MOVE_UNIT (id="Mahir") 39 74}
        {MOVE_UNIT (id="Meherab") 40 72}

        {MODIFY_UNIT (id="Meherab") side 9}

        # Can I do this in one line?
        # {MODIFY_UNIT (id="Mahir") canrecruit,side yes,9}
        # Or, should I just leave it like this to
        # just play it safe?

        {MODIFY_UNIT (id="Mahir") side 9}
        {MODIFY_UNIT (id="Mahir") canrecruit yes}

        # some starting units for Mahir and Meherab

        {GENERIC_UNIT 9 "Outlaw" 40 72}
        {GENERIC_UNIT 9 "Huntress" 40 72}
        {GENERIC_UNIT 9 "Bandit" 40 72}
        {GENERIC_UNIT 9 "Ranger" 40 72}

        # micro AI for meherab
        # to prevent him for doing something
        # suicidal

        [micro_ai]
            side=9
            ai_type=hunter
            action=add

            id="Meherab"
            [filter_location]
                x,y=30-45,68-75
            [/filter_location]
            home_x,home_y=35,70
            rest_turns=2

            show_messages=no
        [/micro_ai]

        {SIMPLE_MESSAGE "Jahin" ( _ "Krog, are you ready for this?")}

        {SIMPLE_MESSAGE "Krog" ( _ "Krog and trolls ready to smash!")}

        {SIMPLE_MESSAGE "Jahin" ( _ "Let us trek northwards then. To the Academy!")}

        [objectives]
            side=1
            silent=no

            [objective]
                description= _ "Acertain what is happening"
                condition="win"
            [/objective]
            [objective]
                description= _ "Jahin reaches the Academy"
                condition="win"
            [/objective]
            [objective]
                description= _ "Death of Jahin"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of any hero unit"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of any non-expendable allied leader"
                condition="lose"
            [/objective]
            {TURNS_RUN_OUT}

            [carryover]
                bonus=yes
                carryover_percentage=40
            [/carryover]

            [note]
                description= _ "Mahir and Meherab will be busy defending the home base."
            [/note]
            [note]
                description= _ "Recalling units with the <i>chaotic</i> alignment is recommended."
            [/note]
        [/objectives]
    [/event]

    {MAIN_HERO_DEATH_EVENTS}
    {MAHIR_DEATH_EVENT}
    {KOJAC_LOYAL_DEATH_EVENT}
    {LOYAL_UNIT_DEATH_EVENT}

    # event when side 2 attacks

    [event]
        name="attack"

        [filter]
            side=2
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        {SIMPLE_MESSAGE "Jahin" ( _ "Defensive stances, everyone! Do not let the enemy circumvent our ranks!")}
    [/event]

    # Woodlanders spawn if enemies capture a village
    # This doesn't trigger for side 1

    [event]
        name=capture
        first_time_only=no

        [filter]
            [filter_location]
                x=1-75
                y=40-75
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=unit.side
                numerical_equals=5
            [/variable]
            [then]
                {CLEAR_VARIABLE cleared_$x1|_$y1|_village}
            [/then]
            [else]
                [if]
                    [variable]
                        name=cleared_$x1|_$y1|_village
                        not_equals=yes
                    [/variable]
                    [then]
                        [set_variable]
                            name=cleared_$x1|_$y1|_village
                            value=yes
                        [/set_variable]

                        [if]
                            [variable]
                                name=unit.side
                                numerical_equals=1
                            [/variable]
                            [then]
                                [set_variable]
                                    name=indigs
                                    rand=0
                                [/set_variable]
                            [/then]
                            [else]
                                [set_variable]
                                    name=indigs
                                    rand=2..4
                                [/set_variable]
                            [/else]
                        [/if]

                        [set_variable]
                            name=indig_countdown
                            value=$indigs
                        [/set_variable]
                        [while]
                            [variable]
                                name=indig_countdown
                                greater_than=0
                            [/variable]
                            [do]
                                [store_locations]
                                    [filter_adjacent_location]
                                        x,y=$x1,$y1
                                    [/filter_adjacent_location]

                                    [not]
                                        [filter]
                                        [/filter]
                                    [/not]

                                    variable=possible_indig_locations
                                [/store_locations]

                                [if]
                                    [variable]
                                        name=possible_indig_locations.length
                                        greater_than=0
                                    [/variable]
                                    [then]
                                        {VARIABLE_OP random_location_index rand "1..$possible_indig_locations.length"}
                                        [set_variable]
                                            name=random_location_index
                                            sub=1
                                        [/set_variable]
                                        {RANDOM (Faun,Young Sasquatch,Golem,Elfin)}
                                        [unit]
                                            type=$random
                                            side=5
                                            x,y=$possible_indig_locations[$random_location_index].x,$possible_indig_locations[$random_location_index].y
                                            generate_name=yes
                                            random_traits=yes
                                        [/unit]
                                    [/then]
                                [/if]
                                [set_variable]
                                    name=indig_countdown
                                    sub=1
                                [/set_variable]
                            [/do]
                        [/while]
                        {CLEAR_VARIABLE indigs_countdown}

                        {CLEAR_VARIABLE possible_indig_locations}
                        {CLEAR_VARIABLE indigs}
                    [/then]

                    [else]
                        [allow_undo]
                        [/allow_undo]
                    [/else]
                [/if]
            [/else]
        [/if]
    [/event]

    # undead wave spawner
    # I am wondering if this is too much...

    [event]
        name="side 2 turn 7, side 2 turn 14, side 2 turn 21, side 2 turn 28, side 2 turn 35, side 2 turn 42"
        first_time_only=no

        {FADE_TO_BLACK}

        {SCATTER_UNITS {ON_DIFFICULTY 45 60 75} "Revenant, Bone Shooter, Death Baron, Necrophage, Dark Invader, Chocobone, Skeleton Rider, Skeleton, Skeleton Archer, Ghost, Shadow, Wraith, Deathblade, Angry One, Rash One, Unhatched, Black Cat, Jinx Beast, Spiteful Watcher, Scornful Watcher, Cloud of Gloom, Howling Darkness, Life Thief, Soul Snatcher" 5 (
            terrain=Gg
            x= 1-75
            y=20-75

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=2
            generate_name=yes
            random_traits=yes
        )}

        {FADE_IN}

        # gold to evil side
        [gold]
            side=2
            amount={ON_DIFFICULTY 320 400 500}
        [/gold]
    [/event]

    # event where heroes
    # remark on the undead waves

    [event]
        name="side 2 turn 7"

        {SIMPLE_MESSAGE "Mahir" ( _ "What on Irdya just happened?! Everthing just went dark and now, we have more of these abominations and aberrants to deal with.")}

        {SIMPLE_MESSAGE "Jahin" ( _ "Oh, no! We have been caught off guard! Brace yourselves! Here they come!")}
    [/event]

    [event]
        name="side 2 turn 14"

        {SIMPLE_MESSAGE "Meherab" ( _ "Even more of them have appeared!")}

        {SIMPLE_MESSAGE "Mahir" ( _ "Jahin, fasten your pace! We cannot hold off the hordes forever!")}
    [/event]

    # orc side gets gold
    # as battle rages on

    [event]
        name="turn 15, turn 30, turn 45"
        first_time_only=no

        [gold]
            side=4
            amount={ON_DIFFICULTY 200 320 440}
        [/gold]
        # Side 5 also gets some
        # gold to ensure a constant combat flow
        [gold]
            side=5
            amount={ON_DIFFICULTY 100 160 220}
        [/gold]
    [/event]

    # sighted events

    {ON_SIGHTING twelve 1 (
        side=6
    ) (
        {SIMPLE_MESSAGE "Krog" ( _ "Jahin, enemies ahead!")}
        {SIMPLE_MESSAGE "Jahin" ( _ "Dispatch them swifty!")}
    )}

    {ON_SIGHTING thirteen 1 (
        side=4
    ) (
        {SIMPLE_MESSAGE "Jahin" ( _ "Orcs and Goblins are here as well? This is going to be a long night.")}
    )}

    # side 6 leader death

    [event]
        name="die"

        [filter]
            id="Undead_Commander2"
        [/filter]

        {SIMPLE_MESSAGE "Mahir" ( _ "Hehe, that was easy!")}

        {SIMPLE_MESSAGE "Meherab" ( _ "Don't drop your guard yet. We got more enemies ahead!")}
    [/event]

    [event]
        name="moveto"
        first_time_only=yes

        [filter]
            side=1
            [filter_adjacent]
                side=5
            [/filter_adjacent]
            [or]
                side=5
                [filter_adjacent]
                    side=1
                [/filter_adjacent]
            [/or]
        [/filter]

        {SIMPLE_MESSAGE "Jahin" ( _ "Umm, hello! Do you know what is going on here?")}

        {UNIT_MESSAGE (side=5) ( _ "We were just defending our forests from an orc warband when suddenly all these abominations and aberrants appeared out of nowhere.")}

        {UNIT_MESSAGE (side=5) ( _ "Please help us!")}

        {SIMPLE_MESSAGE "Jahin" ( _ "We are heading to the Academy to investigate the phenomenon. We shall ensure to eliminate any enemy in our path.")}
    [/event]

    # phase 2 of scenario
    [event]
        name="escape_the_academy"
        first_time_only=yes

        {SCROLL_TO  8 11}
        {DELAY 500}

        [remove_shroud]
            side=1
            x=5-12
            y=10-14
        [/remove_shroud]

        [lift_fog]
            [filter_side]
                side=1
            [/filter_side]
            x=5-12
            y=10-14
            multi_turn=no
        [/lift_fog]

        {SIMPLE_MESSAGE "Alynoic" ( _ "Wait a minute...You're that boy! Jahin!")}

        {SIMPLE_MESSAGE "Jahin" ( _ "It is nice to see you again, Lady Alynoic! Can you tell us what is happening here?")}

        {SIMPLE_MESSAGE "Alynoic" ( _ "A fortnight ago, these aberrants and undead have started attacking us and they have been relentless so far. Our defences are strong however, I fear we may not be able to withstand them for long.")}

        {SIMPLE_MESSAGE "Jahin" ( _ "How can we help? We are no friends of these abominations and their activity here is detrimental to the alliance activities.")}

        {SIMPLE_MESSAGE "Alynoic" ( _ "It may be too much to ask this, but can you take the young students and flee? The rest of us shall remain here and hold off the enemy's advance.")}

        {SIMPLE_MESSAGE "Jahin" ( _ "There must be another way!")}

        {SIMPLE_MESSAGE "Alynoic" ( _ "There is not. You must flee.")}

        {NAMED_GENERIC_UNIT 8 "Adept of Light" 21 11 "mage01"  "Mauni"}
        {NAMED_GENERIC_UNIT 8 "Mage"           21 11 "mage02"   "Norm"}
        [+unit]
            gender=male
        [/unit]
        {NAMED_GENERIC_UNIT 8 "Thunder Mage"   21 11 "mage03" "Mikkel"}
        {NAMED_GENERIC_UNIT 8 "Adept of Light" 21 11 "mage04" "Alynia"}

        [micro_ai]
            side=8
            ai_type=protect_unit
            action=add

            [unit]
                id="mage01"
                goal_x,goal_y=31,74
            [/unit]
            [unit]
                id="mage02"
                goal_x,goal_y=31,74
            [/unit]
            [unit]
                id="mage03"
                goal_x,goal_y=31,74
            [/unit]
            [unit]
                id="mage04"
                goal_x,goal_y=31,74
            [/unit]

            disable_move_leader_to_keep=false
        [/micro_ai]

        {VARIABLE mages_rescued 0}
        {VARIABLE mages_dead 0}

        {SIMPLE_MESSAGE "mage01" ( _ "Please protect us while we flee!")}

        {SIMPLE_MESSAGE "Mahir" ( _ "No worries. Nobody will attack you while I am here.")}

        {SIMPLE_MESSAGE "Meherab" ( _ "You're still at the base camp!")}

        {SIMPLE_MESSAGE "Mahir" ( _ "Thank you so much for ruining my chances of flirting with her.")}
    [/event]

    [event]
        name="check_victory_condition"
        first_time_only=no

        {IF_VAR mages_rescued numerical_equals 4 (
            [then]
                {SIMPLE_MESSAGE "Mahir" ( _ "We have rescued the mages! Let's get out of here!")}

                [endlevel]
                    result=victory
                    {NEW_GOLD_CARRYOVER 40}
                    bonus=yes
                [/endlevel]
            [/then]
        )}
    [/event]

    [event]
        name=moveto
        [filter]
            id="mage01"
            x,y=31,74
        [/filter]
        {VARIABLE_OP mages_rescued add 1}
        [kill]
            id="mage01"
            animate=no
        [/kill]
        [fire_event]
            name="check_victory_condition"
        [/fire_event]
    [/event]
    [event]
        name=moveto
        [filter]
            id="mage02"
            x,y=31,74
        [/filter]
        {VARIABLE_OP mages_rescued add 1}
        [kill]
            id="mage02"
            animate=no
        [/kill]
        [fire_event]
            name="check_victory_condition"
        [/fire_event]
    [/event]
    [event]
        name=moveto
        [filter]
            id="mage03"
            x,y=31,74
        [/filter]
        {VARIABLE_OP mages_rescued add 1}
        [kill]
            id="mage03"
            animate=no
        [/kill]
        [fire_event]
            name="check_victory_condition"
        [/fire_event]
    [/event]
    [event]
        name=moveto
        [filter]
            id="mage04"
            x,y=31,74
        [/filter]
        {VARIABLE_OP mages_rescued add 1}
        [kill]
            id="mage04"
            animate=no
        [/kill]
        [fire_event]
            name="check_victory_condition"
        [/fire_event]
    [/event]

    [event]
        name="mages_died_condition"

        {IF_VAR mages_dead numerical_equals 4 (
            [then]
                {SIMPLE_MESSAGE "Mahir" ( _ "Retreat! We have failed to escort them!")}
                # The main objective was securing a new
                # unit type to recruit so this was
                # a bonus scenario

                [endlevel]
                    result=victory
                    {NEW_GOLD_CARRYOVER 40}
                    bonus=yes
                [/endlevel]
            [/then]
        )}
    [/event]

    [event]
        name="last breath"
        [filter]
            id="mage01"
        [/filter]
        {VARIABLE_OP mages_dead add 1}
        [fire_event]
            name="mages_died_condition"
        [/fire_event]
    [/event]
    [event]
        name="last breath"
        [filter]
            id="mage02"
        [/filter]
        {VARIABLE_OP mages_dead add 1}
        [fire_event]
            name="mages_died_condition"
        [/fire_event]
    [/event]
    [event]
        name="last breath"
        [filter]
            id="mage03"
        [/filter]
        {VARIABLE_OP mages_dead add 1}
        [fire_event]
            name="mages_died_condition"
        [/fire_event]
    [/event]
    [event]
        name="last breath"
        [filter]
            id="mage04"
        [/filter]
        {VARIABLE_OP mages_dead add 1}
        [fire_event]
            name="mages_died_condition"
        [/fire_event]
    [/event]

    [event]
        name="moveto"
        first_time_only=yes
        [filter]
            id="Jahin"
            x=26-44
            y= 7-17
        [/filter]

        [fire_event]
            name="escape_the_academy"
        [/fire_event]
    [/event]

    # jahin no longer recruits
    [event]
        name="turn 5"

        {MODIFY_TERRAIN "Ce" 31 74}
        {SIMPLE_MESSAGE "Jahin" ( _ "I think that I have rallied enough of my troops and I should head to the Academy now.")}
    [/event]
[/scenario]
