#textdomain wesnoth-Hero_of_Irdya_I

[scenario]
    id="02_Towards_the_North"
    name= _ "Towards the North"

# This is a very long scenario
# with changing objectives

    victory_when_enemies_defeated=no

    {SCENARIO_MAP_DATA 1 02_Towards_the_North}
    {NEXT_SCENARIO 03_Into_the_Gloom}
    {TURNS 60 54 48}
    {TIME_OVER_DEFEAT}

    {STORY_TEXT_SCENARIO_02}

    {DEFAULT_SCHEDULE_24H}
    current_time=12

    [side]
        side=1
        {CHARACTER_STATS_JAHIN}
        canrecruit=yes
        controller=human
        fog=yes
        shroud=yes
        {FLAG_VARIANT ragged}
        team_name="good"
        user_team_name= _ "Adventurers"
        recruit="Wisp, Kobold, Vine Beast"
        {GOLD 70 60 50}
        {INCOME 4 3 2}
        village_gold=1
    [/side]

    {STARTING_VILLAGES 1 3}

    [side]
        side=2
        id="Alynoic"
        name= _ "female^Alynoic"
        gender=female
        type="Great Mage"
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT long}
        team_name="good"
        user_team_name= _ "The Academy"
        recruit="Brazier Imp, Furnace Beast, Fire Wisp, Kobold, Stone Golem, Razorbird, Thunderbird, Wisp, Ethereal Orb, Sylph, Zephyr, Ice Crab, Tidal, Undine, Mage, White Mage, Red Mage"
        village_gold=1
        {INCOME 20 18 16}
        {GOLD 400 380 360}

        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT grouping defensive}
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.20}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0.80}            
        [/ai]
    [/side]

    {STARTING_VILLAGES 2 12}

    [side]
        side=3
        id="Wendell"
        name= _ "Lord Wendell"
        type="Sire"
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT loyalist}
        team_name="vampires"
        user_team_name= _ "Vampires"
#ifdef HARD
        recruit="Fledgeling, Thin Blood, Blood Apprentice, Gargoyle, Bloodborn, Blood Hulk, Blood Manipulator, Flesh Artisan, Vampire Duelist, Vampire Noble, Half Blood, Marlgoyle, True Vampire Bat, Vampiric Blood Bat"
#else
        recruit="Fledgeling, Thin Blood, Blood Apprentice, Gargoyle, Bloodborn, Blood Hulk, Vampire Duelist, Half Blood, Marlgoyle, True Vampire Bat, Vampiric Blood Bat"
#endif
        village_gold=0
       {INCOME 40 38 36}
       {GOLD 150 200 280}

        [ai]
            [goal]
                name="target"
                [criteria]
                    side=1
                [/criteria]
                value=0.05
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=2
                [/criteria]
                value=0.60
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=6
                [/criteria]
                value=0.90
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=9
                [/criteria]
                value=0.60
            [/goal]
        [/ai]

    [/side]

    {FORCE_CHANCE_TO_HIT (side=1,2,5,6,7,8,9,10,11,12,13) (id="Wendell") 0 ()}

    [side]
        side=4
        id="Kern"
        name= _ "Lt. Kern"
        type="Vampire Noble"
        gender=male
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT loyalist}
        team_name="vampires"
        user_team_name= _ "Vampires"
        recruit="Fledgeling, Vampire Duelist, Thin Blood, Half Blood, Blood Apprentice, Blood Manipulator, True Vampire Bat, Vampiric Blood Bat, Blood Hulk"
        {GOLD 180 220 250}
        {INCOME 18 23 28}
        [ai]
            [goal]
                name="target"
                [criteria]
                    side=1
                [/criteria]
                value=0.99
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=7
                [/criteria]
                value=0.60
            [/goal]
        [/ai]
    [/side]

    {STARTING_VILLAGES 4 6}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Blood Hulk" 2}
    {FORCE_CHANCE_TO_HIT (side=2,5,6,7,8,9,10,11) (id="Kern") 20 ()}

    [side]
        side=5
        id="Gridash"
        name= _ "Gridash"
        type="Orcish Terror"
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT ragged}
        team_name="orcs"
        user_team_name= _ "Orcs"

#ifdef HARD
        recruit="Orcish Grunt, Orcish Warrior, Orcish Archer, Orcish Crossbowman, Orcish Assassin, Orcish Slayer, Orcish Shaman, Wolf Rider, Goblin Knight"
#else
        recruit="Orcish Grunt, Orcish Warrior, Orcish Archer, Orcish Crossbowman, Orcish Assassin, Orcish Slayer, Orcish Shaman, Wolf Rider"
#endif

        {GOLD 180 200 250}
        {INCOME 12 13 15}
        [ai]
            [goal]
                name="target"
                [criteria]
                    side=7
                [/criteria]
                value=0.99
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=4
                [/criteria]
                value=0.60
            [/goal]
        [/ai]
    [/side]

    {STARTING_VILLAGES 5 6}
    {FORCE_CHANCE_TO_HIT (side=2,3,4,7,10,11) (id="Gridash") 20 ()}

#ifdef HARD
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Orcish Warrior" 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Goblin Knight" 3}
#endif

    [side]
        side=6
        id="Gushnak"
        name= _ "Gushnak"
        type="Orcish Warlord"
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT ragged}
        team_name="orcs"
        user_team_name= _ "Orcs"
#ifdef HARD
        recruit="Orcish Warrior, Orcish Grunt, Orcish Archer, Orcish Crossbowman, Orcish Pyro Archer, Orcish Shaman, Orcish Warlock, Orcish Assassin, Orcish Slayer, Wolf Rider, Goblin Knight, Goblin Pillager, Ogre"
#else
        recruit="Orcish Warrior, Orcish Grunt, Orcish Archer, Orcish Crossbowman, Orcish Pyro Archer, Orcish Shaman, Orcish Assassin, Wolf Rider, Goblin Knight"
#endif
        {INCOME 30 28 26}
        {GOLD 200 250 400}
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Orcish Warrior" 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Goblin Knight" 3}

    {FORCE_CHANCE_TO_HIT (side=1,2,3,4,7,9,10,11) (id="Gushnak") 0 ()}

    [side]
        side=7
        team_name="good, rodents"
        user_team_name= _ "Woodlanders"
        id="Troombadoom"
        name= _ "Troombadoom"
        type="Ancient Wose"
        canrecruit=yes
        controller=ai
        {IS_EXPENDABLE_LEADER}
        {FLAG_VARIANT wood-elvish}
        recruit="Faun, Faun Captain, Golem, Young Sasquatch, Elfin, Rodent Rider, Toxic Plant, Banebush, Wose, Faerie Sprite"
        {GOLD 320 300 300}
        {INCOME 12 11 10}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT grouping offensive}
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.66}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 0.0}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0.33}
        [/ai]
    [/side]

    [side]
        side=8
        id="Grugar"
        name= _ "Grugar"
        type="Orcish Elite Warrior"
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT ragged}
        team_name="orcs"
        user_team_name= _ "Orcs"

        recruit="Orcish Grunt, Orcish Warrior, Orcish Archer, Orcish Pyro Archer, Orcish Crossbowman, Orcish Shaman, Orcish Warlock, Wolf Rider, Goblin Knight, Goblin Pillager"

        {GOLD 170 210 260}
        {INCOME 6 7 8}
        {ai/aliases/stable_singleplayer.cfg}

        [ai]
            version=10710
            [engine]
                name="lua"
                code= <<
                    local ai = ...
                    return wesnoth.require("ai/micro_ais/engines/priority_target_engine.lua").init(ai)
                >>
            [/engine]
            [modify_ai]
                side=8
                action=add
                # wmllint: unbalanced-on
                path=stage[main_loop].candidate_action[]
                # wmllint: unbalanced-off
                [candidate_action]
                    engine=lua
                    name=change_attacks_aspect
                    id=change_attacks_aspect
                    max_score=999999
                    evaluation="return (...):change_attacks_aspect('Troombadoom')"
                    execution="(...):change_attacks_aspect()"
                [/candidate_action]
            [/modify_ai]
        [/ai]
    [/side]

    {FORCE_CHANCE_TO_HIT (side=2,3,4,7,10,11) (id="Grugar") 20 ()}

    [side]
        side=9
        id="Kernix"
        name= _ "Kernix"
        type="Saurian Flanker"
        canrecruit=yes
        controller=ai
        {FLAG_VARIANT ragged}
        team_name="lizards"
        user_team_name= _ "Saurians"
#ifdef HARD
        recruit="Saurian Skirmisher, Saurian Augur, Saurian Ambusher, Saurian Flanker, Saurian Oracle, Naga Fighter, Naga Warrior, Naga Hunter, Naga Marksman"
#else
        recruit="Saurian Skirmisher, Saurian Augur, Saurian Ambusher, Saurian Oracle, Naga Fighter, Naga Warrior, Naga Hunter"
#endif
        {GOLD 480 620 750}
        {INCOME 18 23 28}

        [ai]
            [goal]
                name="target"
                [criteria]
                    side=1
                [/criteria]
                value=0.10
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=2
                [/criteria]
                value=0.60
            [/goal]
            [goal]
                name="target"
                [criteria]
                    side=6
                [/criteria]
                value=0.30
            [/goal]
        [/ai]

    [/side]

    {FORCE_CHANCE_TO_HIT (side=1,2,3,4,5,6,7,8,10,11) (id="Kernix") 0 ()}

    [side]
        side=10
        id="Oworan"
        name= _ "Oworan"
        {IS_EXPENDABLE_LEADER}
        type="Red Mage"
        canrecruit=yes
        controller=ai
        x,y=41,11
        color=navy_blue
        {FLAG_VARIANT long}
        team_name="good"
        hidden=yes
        user_team_name= _ "The Academy"
        recruit="Brazier Imp, Furnace Beast, Fire Wisp"
        {GOLD 80 120 150}
        {INCOME 18 23 28}
    [/side]

    [side]
        side=11
        id="Lemyr"
        name= _ "Lemyr"
        {IS_EXPENDABLE_LEADER}
        type="Red Mage"
        canrecruit=yes
        controller=ai
        x,y=24,12
        color=orchid
        {FLAG_VARIANT long}
        team_name="good"
        hidden=yes
        user_team_name= _ "The Academy"
        recruit="Brazier Imp, Furnace Beast, Fire Wisp"
        {GOLD 80 120 150}
        {INCOME 18 23 28}
    [/side]

    [event]
        name="prestart"

# clear previous variables
# which are not required

        {CLEAR_VARIABLE Kojac_rescued}

# recall your party

        {RECALL "Meherab"}
        {RECALL "Mahir"}
        {RECALL "Krog"}
        {RECALL "Kojac"}
        {RECALL "rider1"}
        {RECALL "rider2"}

# initialise variables

        {VARIABLE ring_taken no}

# place that special item

        {PLACE_IMAGE "items/ring-silver.png" 14 53}

# place the captured Crylix

        {PLACE_IMAGE "units/saurians/skirmisher/skirmisher.png~RC(magenta>steel_blue)" 20 23}
        {PLACE_IMAGE "items/cage.png" 20 23}

# place the guardian units

        {LOYAL_UNIT 6 "Orcish Warrior" 19 24}{FACING sw}
        {GUARDIAN}

        {LOYAL_UNIT 6 "Orcish Pyro Archer" 21 24}{FACING se}
        {GUARDIAN}

        {LOYAL_UNIT 6 "Orcish Juggernaut"  9 31}{GUARDIAN}
        {LOYAL_UNIT 6 "Orcish Warrior"  5 31}{GUARDIAN}
        {LOYAL_UNIT 6 "Orcish Slurbow" 10 30}{GUARDIAN}
        {LOYAL_UNIT 6 "Orcish Elite Warrior" 13 30}{GUARDIAN}

        {LOYAL_UNIT 2 "Lava Giant"  7 10}{GUARDIAN}
        {LOYAL_UNIT 2 "Lava Giant"  9 10}{GUARDIAN}
        {LOYAL_UNIT 2 "Lava Giant"  6 11}{GUARDIAN}
        {LOYAL_UNIT 2 "Lava Giant" 10 11}{GUARDIAN}
        {LOYAL_UNIT 2 "Lava Giant"  7 13}{GUARDIAN}
        {LOYAL_UNIT 2 "Lava Giant"  9 13}{GUARDIAN}

        {LOYAL_UNIT 2 "Stone Golem" 38  5}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 40  6}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 39  7}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 42  7}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 44  8}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 45  8}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 46  9}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 46 11}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 45 10}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 45 16}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 46 14}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 45 14}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 43 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 42 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 42 16}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 40 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 38 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 35 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 34 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 33 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 30 17}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 27 18}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 26 17}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 24 15}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 22 14}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 21 13}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 21 11}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 21 8}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 26 6}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 28 5}{GUARDIAN}
        {LOYAL_UNIT 2 "Stone Golem" 31  5}{GUARDIAN}
        {LOYAL_UNIT 2 "Furnace Beast" 34  4}{GUARDIAN}

# Set initial objectives

        [objectives]
            side=1
            silent=no
            [objective]
                description= _ "Move Jahin to the vicinity of the Academy's Keep (08,11)"
                condition="win"
            [/objective]
            [objective]
                {BONUS_OBJECTIVE_CAPTION}
                description= _ "Explore and rescue any trapped units"
                condition="win"
            [/objective]

            [objective]
                description= _ "Death of Jahin"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of any hero unit"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Alynoic (Commander of the Academy's Defence)"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Kojac"
                condition="lose"
            [/objective]
            {TURNS_RUN_OUT}
            
            [gold_carryover]
                carryover_percentage=50
                bonus=yes
            [/gold_carryover]

            [note]
                description= _ "HINT:
You can recruit units now.
Both Jahin and Faria can recruit/recall units.
Try to level up a few units before advancing to the next scenario."
            [/note]

        [/objectives]

        [micro_ai]
            side=7
            ai_type=recruit_random
            action=add
            skip_low_gold_recruiting=yes
        [/micro_ai]
    [/event]

# Start

    [event]
        name="start"

        {CLEAR_FOG 1 35 70 3}

        [remove_shroud]
             side=1
             x=33-37
             y=68-72
        [/remove_shroud]

        {SCROLL_TO_UNIT "Jahin"}

        {SIMPLE_MESSAGE "Jahin" ( _ "We have arrived at the edge of another forest, which appears to be denser than the last one. I suggest that we begin exploring as a group for we do not know what enemy might attack us.")}

        {SIMPLE_MESSAGE "Meherab" ( _ "What if we encounter vampires here?")}

        {SIMPLE_MESSAGE "Jahin" ( _ "That is highly improbable however, we shall fight them if they dare show their faces here.")}

        [unit]
             side=1
             x,y=35,70
             {CHARACTER_STATS_MALIHA}
#ifdef EASY
             experience=32
#endif
        [/unit]

        [unit]
            side=1
            {CHARACTER_STATS_FARIA}
            x,y=34,70
        [/unit]

        {CAPTURE_VILLAGES 1 35 70 1}

        {MOVE_UNIT (id="Maliha") 33 73}
        {MOVE_UNIT (id="Faria") 32 73}

        {SIMPLE_MESSAGE "Faria" ( _ "Wait, enter the forest at your own peril!")}

        {SIMPLE_MESSAGE "Meherab" ( _ "Why should we be cautious? Is something wrong?")}

        {SIMPLE_MESSAGE "Maliha" ( _ "Orcs and vampires roam the forest with unknown motives. My friends are trying to rout them, but their attempts have been unsuccessful. Leave now, before the orcs or vampires detect your presence.")}

        {SIMPLE_MESSAGE "Mahir" ( _ "Vampires? Yay! I get to kill some blood-suckers!")}

        {SIMPLE_MESSAGE "Jahin" ( _ "Vampires? Well, we are no friends of theirs. May we join the fight?")}

        {SIMPLE_MESSAGE "Krog" ( _ "Krog ready to kill orcs and vampires!")}

        {SIMPLE_MESSAGE "Maliha" ( _ "You all sound persistent and I shall help you guys out then. By the way, my name is Maliha and this my friend, Faria.")}

        {SIMPLE_MESSAGE "Faria" ( _ "Hi! Nice to meet all of you!")}

        {SIMPLE_MESSAGE "Jahin" ( _ "Nice to meet you too, Maliha and Faria. My name is Jahin and these my companions - Mahir, Meherab, Krog and Kojac.")}

        {SIMPLE_MESSAGE "Maliha" ( _ "Well met, friend. However, I'm afraid proper introductions have to wait. My friend is rallying the protectors of the forest to engage the orcs and vampires.")}

        {SIMPLE_MESSAGE "Mahir" ( _ "Protectors of the forest?")}

        {SIMPLE_MESSAGE "Maliha" ( _ "They call themselves the <i>Woodlanders</i> and I have a feeling that you will be meeting them soon,")}

        {UNCLEAR_FOG}

        {SIMPLE_MESSAGE "Faria" ( _ "There is a vacant summoning centre a few yards North from here. We should all head there first so that I can summon some elementals to aid us.")}

        {NARRATOR_MESSAGE ( _ "HINT: A summoning centre and its surrounding runes have the same function as that of a keep and its adjacent castle tiles, with the addition of granting +8 HP healing per turn.")}
    [/event]

    [event]
        name="turn 2"
       
        {SIMPLE_MESSAGE "Jahin" ( _ "Faria, do you have any idea where the enemy bases are located?")}

        {SIMPLE_MESSAGE "Faria" ( _ "The vampire camp is northeast from here and there are two orcish campsites: one is due west and the other is northwestwards. The orcs are comparatively stronger but the woodlanders can overwhelm them with your help. There are more enemies beyond the forest's northern borders but they will most likely be occupied with each other rather than reinforcing their troops here.")}
    [/event]

# Naga wave spawner

    [event]
        name="turn 3, turn 7, turn 12, turn 17, turn 22, turn 27, turn 32, turn 37, turn 42, turn 47, turn 52"
        first_time_only=no
            
                {RANDOM 1..4}

                [switch]
                    variable=random

                    [case]
                        value=1

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  1  1}
                        {GENERIC_UNIT 9 "Saurian Augur"  7  1}
                        {GENERIC_UNIT 9 "Saurian Skirmisher" 27  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  3  2}
                        {GENERIC_UNIT 9 "Naga Fighter"  8  1}
                        {GENERIC_UNIT 9 "Saurian Ambusher" 33  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher" 20  2}
                        {GENERIC_UNIT 9 "Naga Guardian" 37  1}
                        {GENERIC_UNIT 9 "Naga Warrior" 39  1}
                    [/case]

                    [case]
                        value=2

                        {GENERIC_UNIT 9 "Saurian Ambusher"  1  1}
                        {GENERIC_UNIT 9 "Saurian Augur"  7  1}
                        {GENERIC_UNIT 9 "Saurian Oracle" 27  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  3  2}
                        {GENERIC_UNIT 9 "Naga Warrior"  8  1}
                        {GENERIC_UNIT 9 "Saurian Ambusher" 33  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher" 20  2}
                        {GENERIC_UNIT 9 "Naga Warden" 37  1}
                        {GENERIC_UNIT 9 "Naga Warrior" 39  1}
                    [/case]

                    [case]
                        value=3

                        {GENERIC_UNIT 9 "Saurian Soothsayer"  1  1}
                        {GENERIC_UNIT 9 "Saurian Augur"  7  1}
                        {GENERIC_UNIT 9 "Saurian Skirmisher" 27  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  3  2}
                        {GENERIC_UNIT 9 "Naga Marksman"  8  1}
                        {GENERIC_UNIT 9 "Saurian Ambusher" 33  1}

                        {GENERIC_UNIT 9 "Saurian Flanker" 20  2}
                        {GENERIC_UNIT 9 "Naga Sentinel" 37  1}
                        {GENERIC_UNIT 9 "Naga Warrior" 39  1}
                    [/case]

                    [case]
                        value=4

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  1  1}
                        {GENERIC_UNIT 9 "Saurian Oracle"  7  1}
                        {GENERIC_UNIT 9 "Saurian Augur" 27  1}

                        {GENERIC_UNIT 9 "Saurian Skirmisher"  3  2}
                        {GENERIC_UNIT 9 "Naga Fighter"  8  1}
                        {GENERIC_UNIT 9 "Saurian Ambusher" 33  1}

                        {GENERIC_UNIT 9 "Saurian Flanker" 20  2}
                        {GENERIC_UNIT 9 "Naga Guardian" 37  1}
                        {GENERIC_UNIT 9 "Naga Myrmidon" 39  1}
                    [/case]
                [/switch]

                {CLEAR_VARIABLE random}

    [/event]

# The death events

    {MAIN_HERO_DEATH_EVENTS}
    {MAHIR_DEATH_EVENT}
    {FARIA_DEATH_EVENT}
    {KOJAC_DEATH_EVENT_1}
    {LOYAL_UNIT_DEATH_EVENT}

    [event]
        name="last breath"

        [filter]
            id="Alynoic"
        [/filter]

        {SIMPLE_MESSAGE "unit" ( _ "With my death, the Academy falls!")}
    [/event]

    [event]
        name="die"

        [filter]
            id="Alynoic"
        [/filter]

        {ENDLEVEL_DEFEAT}
    [/event]

    [event]
        name="last breath"

        [filter]
            id="Troombadoom"
        [/filter]

        {SIMPLE_MESSAGE "unit" ( _ "Alas, I have failed to protect the forest!")}
    [/event]

    [event]
        name="last breath"

        [filter]
            id="Grugar"
        [/filter]

        {SIMPLE_MESSAGE "Meherab" ( _ "Die, you filthy orc!")}
    [/event]

    [event]
        name="die"

        [filter]
            id="Grugar"
        [/filter]


#ifdef EASY
                    {LOOT 70 1}
#endif
#ifdef NORMAL
                    {LOOT 60 1}
#endif
#ifdef HARD
                    {LOOT 50 1}
#endif

    [/event]

    [event]
        name="last breath"

        [filter]
            id="Gridash"
        [/filter]

        {SIMPLE_MESSAGE "Krog" ( _ "Orc deserves death for brutal deeds orc had done!")}
    [/event]

    [event]
        name="die"

        [filter]
            id="Gridash"
        [/filter]

#ifdef EASY
                    {LOOT 70 1}
#endif
#ifdef NORMAL
                    {LOOT 60 1}
#endif
#ifdef HARD
                    {LOOT 50 1}
#endif

    [/event]

    [event]
        name="last breath"

        [filter]
            id="Kern"
        [/filter]

        {SIMPLE_MESSAGE "Mahir" ( _ "It feels good to see a vampire die!")}
        {SIMPLE_MESSAGE "Meherab" ( _ "Aren't vampires already dead?")}
        {SIMPLE_MESSAGE "Mahir" ({ASIDE ( _ "Well, then it still feels good to see this one die again!")})}
    [/event]

    [event]
        name="die"

        [filter]
            id="Kern"
        [/filter]

#ifdef EASY
                    {LOOT 70 1}
#endif
#ifdef NORMAL
                    {LOOT 60 1}
#endif
#ifdef HARD
                    {LOOT 50 1}
#endif

    [/event]

# Orcs and Vampires are invading the forest of
# the Woodlanders, so why don't we make
# things a bit difficult for them...

    [event]
        name=capture
        first_time_only=no

        [filter]
            [filter_location]
                x=1-48
                y=40-75
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=unit.side
                numerical_equals=7
            [/variable]
            [then]
                {CLEAR_VARIABLE cleared_$x1|_$y1|_village}
            [/then]
            [else]
                [if]
                    [variable]
                        name=cleared_$x1|_$y1|_village
                        not_equals=yes
                    [/variable]
                    [then]
                        [set_variable]
                            name=cleared_$x1|_$y1|_village
                            value=yes
                        [/set_variable]
                        
                        [if]
                            [variable]
                                name=unit.side
                                numerical_equals=1
                            [/variable]
                            [then]
                                [set_variable]
                                    name=indigs
                                    rand=0
                                [/set_variable]
                            [/then]
                            [else]
                               
                                [set_variable]
                                    name=indigs
                                    rand=2..4
                                [/set_variable]
                            [/else]
                        [/if]
                       
                        [set_variable]
                            name=indig_countdown
                            value=$indigs
                        [/set_variable]
                        [while]
                            [variable]
                                name=indig_countdown
                                greater_than=0
                            [/variable]
                            [do]
                                [store_locations]
                                    [filter_adjacent_location]
                                        x,y=$x1,$y1
                                    [/filter_adjacent_location]

                                    [not]
                                        [filter]
                                        [/filter]
                                    [/not]

                                    variable=possible_indig_locations
                                [/store_locations]

                                [if]
                                    [variable]
                                        name=possible_indig_locations.length
                                        greater_than=0
                                    [/variable]
                                    [then]
                                        {VARIABLE_OP random_location_index rand "1..$possible_indig_locations.length"}
                                        [set_variable]
                                            name=random_location_index
                                            sub=1
                                        [/set_variable]
                                        {RANDOM (Faun,Young Sasquatch,Golem,Elfin)}
                                        [unit]
                                            type=$random
                                            side=7
                                            x,y=$possible_indig_locations[$random_location_index].x,$possible_indig_locations[$random_location_index].y
                                            generate_name=yes
                                            random_traits=yes
                                        [/unit]
                                    [/then]
                                [/if]
                                [set_variable]
                                    name=indig_countdown
                                    sub=1
                                [/set_variable]
                            [/do]
                        [/while]
                        {CLEAR_VARIABLE indigs_countdown}
                        
                        {CLEAR_VARIABLE possible_indig_locations}
                        {CLEAR_VARIABLE indigs}
                    [/then]

                    [else]
                        [allow_undo]
                        [/allow_undo]
                    [/else]
                [/if]
            [/else]
        [/if]
    [/event]

# Main victory condition

    [event]
        name="moveto"
        first_time_only=yes
 
        [filter]
            id="Jahin"
            [filter_location]
                x,y= 8,11
                radius=4
            [/filter_location]
        [/filter]

    
        {SIMPLE_MESSAGE "Alynoic" ( _ "Hey, who are you?")}

        {SIMPLE_MESSAGE "Jahin" ( _ "My name is Jahin and these are my friends. We have come from the vampire-occupied human city that is situated south from here. We seek an audience with your leader.")}

        {SIMPLE_MESSAGE "Alynoic" ( _ "You have come to seek asylum? Very well, come inside.")}

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 50}
        [/endlevel]
          
    [/event]

# Crylix

    [event]
        name="moveto"
        first_time_only=yes

        [filter]
            side=1
            x,y=20,23
        [/filter]

        {REMOVE_IMAGE 20 23}

        [unit]
            side=1
            x,y=20,23
            {CHARACTER_STATS_CRYLIX}
        [/unit]

        {SIMPLE_MESSAGE "Crylix" ( _ "Thank you, humansss. You have liberated me and for that I am grateful. Allow me to join you in your questsss.")}

        {SIMPLE_MESSAGE "Meherab" ( _ "You are most welcome, friend. We accept your offer. Do you have a name?")}

        {SIMPLE_MESSAGE "Crylix" ( _ "I am Crylix, son of Lazki.")}

    [/event]

# Ring of the Warrior

    [event]
        name="moveto"
        first_time_only=no

        [filter]
            side=1
            x,y=14,53
        [/filter]

        [filter_condition]
            {VARIABLE ring_taken no}
        [/filter_condition]

        [item_dialog]
             name= _ "Ring of the Warrior"
             image="icons/stone_ring.png"
             description= _ "These ring bears the markings of an ancient civilisation. However, you deduce that one of the diminutive patterns resembles a sword; implying that its original bearer was a renowned fighter and now, the ring seeks a new one."
             effect= _ "This ring grants +1 melee damage. Choose its wearer carefully."
             variable=ring_taken
        [/item_dialog]

        [if]
            {VARIABLE_CONDITIONAL ring_taken equals yes}
            [then]
                {REMOVE_IMAGE 14 53}

                [object]
                    id="ring_of_the_warrior"
                    name= _ "Ring of the Warrior"
                    image="icons/stone_ring.png"
                    duration=forever
                    description= _ "Equipping this ring grants +1 melee damage."
                    [effect]
                        apply_to=attack
                        range=melee
                        increase_damage=1
                    [/effect]
                [/object]
            [/then]
            [else]
                [allow_undo]
                [/allow_undo]
            [/else]
        [/if]
    [/event]

# sighting events

    {ON_SIGHTING two 1 (side=7) (

        {SIMPLE_MESSAGE "unit" ( _ "Hey, are you a member of the Woodlanders?")}

        {SIMPLE_MESSAGE "second_unit" ( _ "Yes, I am one of the many protectors of the forest.")}

    )}

    {ON_SIGHTING three 1 (id="Troombadoom") (

        {SIMPLE_MESSAGE "Troombadoom" ( _ "Greetings, young ones. What brings you to this ancient forest?")}

        {SIMPLE_MESSAGE "Jahin" ( _ "We are just passing through, ancient one. However, we would not mind fighting a few orcs or vampires along the way.")}

        {SIMPLE_MESSAGE "Troombadoom" ( _ "I sense potential in you, Boy. I shall share some information with you. There is a treasure northeastwards from my current location. You shall find it on an island.")}

        [modify_side]
            side=7
            share_view=yes
            share_map=no
        [/modify_side]
    )}

    {ON_SIGHTING four 1 (side=4) (

        {SIMPLE_MESSAGE "Mahir" ( _ "Vampire!")}

        {SIMPLE_MESSAGE "second_unit" ( _ "Look, humans! They must be escapees from Verdanyn. Capture them!")}
    )}

    {ON_SIGHTING five 1 (race="elemental") (

        {SIMPLE_MESSAGE "Meherab" ( _ "Wow, what a fascinating creature!")}

        {SIMPLE_MESSAGE "Maliha" ( _ "That is an elemental construct, summoned by a mage versed well in summoning magic. There are many different types of elementals, each grouped into any one of the four elements: fire, earth, water and air. However, necromancy is a form of conjuration magic that is forbidden.")}
    )}

# FIXED BUG
# Notes:
# It was triggering at the start because
# the player has Kojac in his active army

    {ON_SIGHTING six 1 (
        race="orc"
        [not]
            id="Kojac"
        [/not]
    ) (

        {SIMPLE_MESSAGE "Mahir" ( _ "Look, there's an orc! Let's kill him!")}
    )}

# Select unit events

    [event]
        name="select"
        
        [filter]
            id="Maliha"
        [/filter]

        {CHARACTER_DESCRIPTION_MESSAGE ( _ "Maliha has basic healing capabilities and a moderate ranged <i>arcane</i> attack. Shield her from attacks but, don't neglect her to earn experience. In this campaign, she has two advancement choices: the <i>White Mage</i> and the <i>Cleric</i>. The former grants stronger healing abilities and the latter focuses mainly on heavy arcane damage. Hence, choosing her advancement path is paramount to the effective difficulty of the campaign.")}
    [/event]

    [event]
        name="select"
        
        [filter]
            id="Faria"
        [/filter]

        {CHARACTER_DESCRIPTION_MESSAGE ( _ "Elemental summoning, rejuvenation, and <i>nature flares</i> are Faria's strong points. Being a mage, makes her susceptible to enemies with strong melee attacks and hence, she should be protected whenever possible. Her presence allows you to recruit <i>Kobolds</i>, <i>Vine Beasts</i> and <i>Wisps</i>. <i>Wisps</i>, when given enough experience (XP) points, can advance to the other elemental types.")}

#ifndef HARD
        {NARRATOR_MESSAGE ( _ "HINT:

In the following scenarios, your predominant adversaries will be the <i>Undead</i>. Hence, it is advisable to level up <i>Wisps</i> to <i>Brazier Imps</i> and <i>Ethereal Orbs</i>. However, <i>Sylphs</i>, <i>Razorbirds</i>, <i>Tidals</i> and their advancements will be useful in later scenarios.")}
#endif
    [/event]

    [event]
        name="time over"

        [sound]
            name="dwarf-laugh.wav"
        [/sound]
        {SIMPLE_MESSAGE "Wendell" ( _ "<i>(sinister laughter)</i> My reinforcements have arrived! Prepare to be decimated!" )}

        {SIMPLE_MESSAGE "Jahin" ( _ "Oh, no! The vampires have received reinforcements! The situation is hopeless now!")}
    [/event]

[/scenario]